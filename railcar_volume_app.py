import streamlit as st

# Conversion functions
def inches_to_cm(inches):
    return inches * 2.54

def cm_to_inches(cm):
    return cm / 2.54

def interpolate(data, x):
    keys = sorted(data.keys())
    if x < keys[0] or x > keys[-1]:
        return None
    if x in data:
        return data[x]
    for i in range(len(keys) - 1):
        if keys[i] < x < keys[i + 1]:
            x0, y0 = keys[i], data[keys[i]]
            x1, y1 = keys[i + 1], data[keys[i + 1]]
            return y0 + (y1 - y0) * (x - x0) / (x1 - x0)
    return None

# Full data for SKSX117122 (inches: gallons)
SXSX117122 = {
    0.25: 23, 0.5: 47, 0.75: 72, 1.0: 98, 1.25: 125, 1.5: 153, 1.75: 182, 2.0: 212, 2.25: 242, 2.5: 274,
    2.75: 306, 3.0: 339, 3.25: 373, 3.5: 408, 3.75: 443, 4.0: 479, 4.25: 516, 4.5: 553, 4.75: 591, 5.0: 629,
    5.25: 669, 5.5: 709, 5.75: 749, 6.0: 790, 6.25: 832, 6.5: 874, 6.75: 916, 7.0: 960, 7.25: 1004, 7.5: 1048,
    7.75: 1093, 8.0: 1138, 8.25: 1184, 8.5: 1230, 8.75: 1277, 9.0: 1325, 9.25: 1373, 9.5: 1421, 9.75: 1470, 10.0: 1519,
    10.25: 1568, 10.5: 1619, 10.75: 1669, 11.0: 1720, 11.25: 1772, 11.5: 1823, 11.75: 1876, 12.0: 1928, 12.25: 1981, 12.5: 2035,
    12.75: 2089, 13.0: 2143, 13.25: 2198, 13.5: 2253, 13.75: 2308, 14.0: 2364, 14.25: 2420, 14.5: 2476, 14.75: 2533, 15.0: 2591,
    15.25: 2648, 15.5: 2706, 15.75: 2764, 16.0: 2823, 16.25: 2882, 16.5: 2941, 16.75: 3001, 17.0: 3061, 17.25: 3121, 17.5: 3181,
    17.75: 3242, 18.0: 3303, 18.25: 3365, 18.5: 3427, 18.75: 3489, 19.0: 3551, 19.25: 3614, 19.5: 3677, 19.75: 3740, 20.0: 3804,
    20.25: 3867, 20.5: 3931, 20.75: 3996, 21.0: 4060, 21.25: 4125, 21.5: 4191, 21.75: 4256, 22.0: 4322, 22.25: 4388, 22.5: 4454,
    22.75: 4520, 23.0: 4587, 23.25: 4654, 23.5: 4721, 23.75: 4789, 24.0: 4856, 24.25: 4924, 24.5: 4992, 24.75: 5061, 25.0: 5129,
    25.25: 5198, 25.5: 5267, 25.75: 5337, 26.0: 5406, 26.25: 5476, 26.5: 5546, 26.75: 5616, 27.0: 5686, 27.25: 5757, 27.5: 5828,
    27.75: 5899, 28.0: 5970, 28.25: 6041, 28.5: 6113, 28.75: 6185, 29.0: 6256, 29.25: 6329, 29.5: 6401, 29.75: 6473, 30.0: 6546,
    30.25: 6619, 30.5: 6692, 30.75: 6765, 31.0: 6839, 31.25: 6912, 31.5: 6986, 31.75: 7060, 32.0: 7134, 32.25: 7208, 32.5: 7283,
    32.75: 7357, 33.0: 7432, 33.25: 7507, 33.5: 7582, 33.75: 7657, 34.0: 7732, 34.25: 7808, 34.5: 7883, 34.75: 7959, 35.0: 8035,
    35.25: 8111, 35.5: 8187, 35.75: 8264, 36.0: 8340, 36.25: 8417, 36.5: 8493, 36.75: 8570, 37.0: 8647, 37.25: 8724, 37.5: 8802,
    37.75: 8879, 38.0: 8956, 38.25: 9034, 38.5: 9112, 38.75: 9189, 39.0: 9267, 39.25: 9345, 39.5: 9423, 39.75: 9502, 40.0: 9580,
    40.25: 9658, 40.5: 9737, 40.75: 9816, 41.0: 9894, 41.25: 9973, 41.5: 10052, 41.75: 10131, 42.0: 10210, 42.25: 10290, 42.5: 10369,
    42.75: 10448, 43.0: 10528, 43.25: 10607, 43.5: 10687, 43.75: 10767, 44.0: 10847, 44.25: 10926, 44.5: 11006, 44.75: 11086, 45.0: 11166,
    45.25: 11247, 45.5: 11327, 45.75: 11407, 46.0: 11487, 46.25: 11568, 46.5: 11648, 46.75: 11729, 47.0: 11809, 47.25: 11890, 47.5: 11971,
    47.75: 12051, 48.0: 12132, 48.25: 12213, 48.5: 12294, 48.75: 12375, 49.0: 12456, 49.25: 12537, 49.5: 12618, 49.75: 12699, 50.0: 12780,
    50.25: 12861, 50.5: 12943, 50.75: 13024, 51.0: 13105, 51.25: 13186, 51.5: 13268, 51.75: 13349, 52.0: 13430, 52.25: 13512, 52.5: 13593,
    52.75: 13675, 53.0: 13756, 53.25: 13837, 53.5: 13919, 53.75: 14000, 54.0: 14082, 54.25: 14163, 54.5: 14245, 54.75: 14326, 55.0: 14408,
    55.25: 14490, 55.5: 14571, 55.75: 14653, 56.0: 14734, 56.25: 14816, 56.5: 14897, 56.75: 14979, 57.0: 15060, 57.25: 15142, 57.5: 15223,
    57.75: 15305, 58.0: 15386, 58.25: 15468, 58.5: 15549, 58.75: 15631, 59.0: 15712, 59.25: 15794, 59.5: 15875, 59.75: 15957, 60.0: 16038,
    60.25: 16120, 60.5: 16201, 60.75: 16283, 61.0: 16364, 61.25: 16446, 61.5: 16527, 61.75: 16609, 62.0: 16690, 62.25: 16772, 62.5: 16853,
    62.75: 16935, 63.0: 17016, 63.25: 17098, 63.5: 17179, 63.75: 17261, 64.0: 17342, 64.25: 17423, 64.5: 17504, 64.75: 17585, 65.0: 17666,
    65.25: 17747, 65.5: 17828, 65.75: 17909, 66.0: 17990, 66.25: 18071, 66.5: 18152, 66.75: 18233, 67.0: 18313, 67.25: 18394, 67.5: 18475,
    67.75: 18556, 68.0: 18636, 68.25: 18717, 68.5: 18798, 68.75: 18878, 69.0: 18959, 69.25: 19039, 69.5: 19120, 69.75: 19200, 70.0: 19281,
    70.25: 19361, 70.5: 19441, 70.75: 19521, 71.0: 19601, 71.25: 19681, 71.5: 19761, 71.75: 19841, 72.0: 19921, 72.25: 20001, 72.5: 20081,
    72.75: 20161, 73.0: 20241, 73.25: 20321, 73.5: 20401, 73.75: 20481, 74.0: 20561, 74.25: 20641, 74.5: 20720, 74.75: 20800, 75.0: 20880,
    75.25: 20959, 75.5: 21039, 75.75: 21118, 76.0: 21198, 76.25: 21277, 76.5: 21356, 76.75: 21436, 77.0: 21515, 77.25: 21594, 77.5: 21673,
    77.75: 21752, 78.0: 21831, 78.25: 21910, 78.5: 21989, 78.75: 22068, 79.0: 22147, 79.25: 22226, 79.5: 22305, 79.75: 22384, 80.0: 22463,
    80.25: 22542, 80.5: 22620, 80.75: 22699, 81.0: 22778, 81.25: 22856, 81.5: 22935, 81.75: 23013, 82.0: 23092, 82.25: 23170, 82.5: 23249,
    82.75: 23327, 83.0: 23405, 83.25: 23484, 83.5: 23562, 83.75: 23640, 84.0: 23718, 84.25: 23796, 84.5: 23874, 84.75: 23952, 85.0: 24030,
    85.25: 24108, 85.5: 24185, 85.75: 24263, 86.0: 24340, 86.25: 24418, 86.5: 24495, 86.75: 24572, 87.0: 24650, 87.25: 24727, 87.5: 24804,
    87.75: 24881, 88.0: 24958, 88.25: 25035, 88.5: 25112, 88.75: 25189, 89.0: 25266, 89.25: 25343, 89.5: 25420, 89.75: 25497, 90.0: 25573,
    90.25: 25650, 90.5: 25726, 90.75: 25803, 91.0: 25879, 91.25: 25955, 91.5: 26031, 91.75: 26107, 92.0: 26183, 92.25: 26259, 92.5: 26335,
    92.75: 26410, 93.0: 26486, 93.25: 26561, 93.5: 26637, 93.75: 26712, 94.0: 26787, 94.25: 26862, 94.5: 26937, 94.75: 27012, 95.0: 27087,
    95.25: 27162, 95.5: 27237, 95.75: 27312, 96.0: 27387, 96.25: 27461, 96.5: 27536, 96.75: 27610, 97.0: 27684, 97.25: 27758, 97.5: 27832,
    97.75: 27906, 98.0: 27980, 98.25: 28054, 98.5: 28128, 98.75: 28202, 99.0: 28275, 99.25: 28349, 99.5: 28422, 99.75: 28495, 100.0: 28568,
    100.25: 28641, 100.5: 28714, 100.75: 28787, 101.0: 28860, 101.25: 28933, 101.5: 29005, 101.75: 29078, 102.0: 29150, 102.25: 29222,
    102.5: 29294, 102.75: 29366, 103.0: 29438, 103.25: 29510, 103.5: 29582, 103.75: 29653, 104.0: 29725, 104.25: 29796, 104.5: 29867,
    104.75: 29938, 105.0: 30009, 105.25: 30080, 105.5: 30151, 105.75: 30222, 106.0: 30293, 106.25: 30363, 106.5: 30434, 106.75: 30504,
    107.0: 30574, 107.25: 30644, 107.5: 30714, 107.75: 30784, 108.0: 30854, 108.25: 30923, 108.5: 30993, 108.75: 31062, 109.0: 31131,
    109.25: 31200, 109.5: 31269, 109.75: 31338, 110.0: 31407, 110.25: 31476, 110.5: 31544, 110.75: 31613, 111.0: 31681, 111.25: 31749,
    111.5: 31817, 111.75: 31885, 112.0: 31953, 112.25: 32021, 112.5: 32088, 112.75: 32156, 113.0: 32223, 113.25: 32291, 113.5: 32358,
    113.75: 32425, 114.0: 32492, 114.25: 32559, 114.5: 32626, 114.75: 32692, 115.0: 32759, 115.25: 32825, 115.5: 32891, 115.75: 32957,
    116.0: 33023, 116.25: 33089, 116.5: 33155, 116.75: 33220, 117.0: 33286
}

# Full data for TCLX290169 (inches: gallons)
TCLX290169 = {
    0.00: 0, 0.25: 30, 0.5: 60, 0.75: 91, 1.00: 123, 1.25: 156, 1.50: 190, 1.75: 224, 2.00: 259, 2.25: 295,
    2.50: 331, 2.75: 368, 3.00: 405, 3.25: 444, 3.50: 482, 3.75: 522, 4.00: 562, 4.25: 602, 4.50: 643, 4.75: 685,
    5.00: 727, 5.25: 770, 5.50: 813, 5.75: 857, 6.00: 901, 6.25: 946, 6.50: 991, 6.75: 1037, 7.00: 1083, 7.25: 1130,
    7.50: 1177, 7.75: 1225, 8.00: 1273, 8.25: 1321, 8.50: 1370, 8.75: 1420, 9.00: 1469, 9.25: 1520, 9.50: 1570, 9.75: 1621,
    10.00: 1673, 10.25: 1725, 10.50: 1777, 10.75: 1829, 11.00: 1882, 11.25: 1936, 11.50: 1990, 11.75: 2044, 12.00: 2098,
    12.25: 2153, 12.50: 2208, 12.75: 2264, 13.00: 2320, 13.25: 2376, 13.50: 2433, 13.75: 2490, 14.00: 2547, 14.25: 2605,
    14.50: 2663, 14.75: 2721, 15.00: 2780, 15.25: 2838, 15.50: 2898, 15.75: 2957, 16.00: 3017, 16.25: 3077, 16.50: 3138,
    16.75: 3198, 17.00: 3260, 17.25: 3321, 17.50: 3382, 17.75: 3444, 18.00: 3507, 18.25: 3569, 18.50: 3632, 18.75: 3695,
    19.00: 3758, 19.25: 3822, 19.50: 3885, 19.75: 3949, 20.00: 4014, 20.25: 4078, 20.50: 4143, 20.75: 4208, 21.00: 4274,
    21.25: 4339, 21.50: 4405, 21.75: 4471, 22.00: 4537, 22.25: 4604, 22.50: 4671, 22.75: 4738, 23.00: 4805, 23.25: 4872,
    23.50: 4940, 23.75: 5008, 24.00: 5076, 24.25: 5144, 24.50: 5213, 24.75: 5281, 25.00: 5350, 25.25: 5419, 25.50: 5489,
    25.75: 5558, 26.00: 5628, 26.25: 5698, 26.50: 5768, 26.75: 5838, 27.00: 5909, 27.25: 5980, 27.50: 6051, 27.75: 6122,
    28.00: 6193, 28.25: 6264, 28.50: 6336, 28.75: 6408, 29.00: 6480, 29.25: 6552, 29.50: 6624, 29.75: 6697, 30.00: 6769,
    30.25: 6842, 30.50: 6915, 30.75: 6988, 31.00: 7061, 31.25: 7135, 31.50: 7208, 31.75: 7282, 32.00: 7356, 32.25: 7430,
    32.50: 7504, 32.75: 7579, 33.00: 7653, 33.25: 7728, 33.50: 7802, 33.75: 7877, 34.00: 7952, 34.25: 8028, 34.50: 8103,
    34.75: 8178, 35.00: 8254, 35.25: 8329, 35.50: 8405, 35.75: 8481, 36.00: 8557, 36.25: 8633, 36.50: 8710, 36.75: 8786,
    37.00: 8862, 37.25: 8939, 37.50: 9016, 37.75: 9093, 38.00: 9170, 38.25: 9247, 38.50: 9324, 38.75: 9401, 39.00: 9478,
    39.25: 9556, 39.50: 9633, 39.75: 9711, 40.00: 9789, 40.25: 9866, 40.50: 9944, 40.75: 10022, 41.00: 10100, 41.25: 10178,
    41.50: 10257, 41.75: 10335, 42.00: 10413, 42.25: 10492, 42.50: 10570, 42.75: 10649, 43.00: 10728, 43.25: 10807, 43.50: 10885,
    43.75: 10964, 44.00: 11043, 44.25: 11122, 44.50: 11201, 44.75: 11281, 45.00: 11360, 45.25: 11439, 45.50: 11518, 45.75: 11598,
    46.00: 11677, 46.25: 11757, 46.50: 11836, 46.75: 11916, 47.00: 11996, 47.25: 12075, 47.50: 12155, 47.75: 12235, 48.00: 12315,
    48.25: 12395, 48.50: 12474, 48.75: 12554, 49.00: 12634, 49.25: 12714, 49.50: 12794, 49.75: 12874, 50.00: 12955, 50.25: 13035,
    50.50: 13115, 50.75: 13195, 51.00: 13275, 51.25: 13355, 51.50: 13436, 51.75: 13516, 52.00: 13596, 52.25: 13676, 52.50: 13757,
    52.75: 13837, 53.00: 13917, 53.25: 13998, 53.50: 14078, 53.75: 14158, 54.00: 14239, 54.25: 14319, 54.50: 14399, 54.75: 14480,
    55.00: 14560, 55.25: 14640, 55.50: 14721, 55.75: 14801, 56.00: 14881, 56.25: 14962, 56.50: 15042, 56.75: 15122, 57.00: 15202,
    57.25: 15283, 57.50: 15363, 57.75: 15443, 58.00: 15523, 58.25: 15604, 58.50: 15684, 58.75: 15764, 59.00: 15844, 59.25: 15924,
    59.50: 16004, 59.75: 16084, 60.00: 16164, 60.25: 16244, 60.50: 16324, 60.75: 16404, 61.00: 16483, 61.25: 16563, 61.50: 16643,
    61.75: 16723, 62.00: 16802, 62.25: 16882, 62.50: 16961, 62.75: 17041, 63.00: 17120, 63.25: 17200, 63.50: 17279, 63.75: 17358,
    64.00: 17438, 64.25: 17517, 64.50: 17596, 64.75: 17675, 65.00: 17754, 65.25: 17833, 65.50: 17912, 65.75: 17990, 66.00: 18069,
    66.25: 18148, 66.50: 18226, 66.75: 18305, 67.00: 18383, 67.25: 18461, 67.50: 18540, 67.75: 18618, 68.00: 18696, 68.25: 18774,
    68.50: 18852, 68.75: 18929, 69.00: 19007, 69.25: 19085, 69.50: 19162, 69.75: 19240, 70.00: 19317, 70.25: 19394, 70.50: 19471,
    70.75: 19548, 71.00: 19625, 71.25: 19702, 71.50: 19779, 71.75: 19855, 72.00: 19932, 72.25: 20008, 72.50: 20084, 72.75: 20161,
    73.00: 20237, 73.25: 20313, 73.50: 20388, 73.75: 20464, 74.00: 20539, 74.25: 20615, 74.50: 20690, 74.75: 20765, 75.00: 20840,
    75.25: 20915, 75.50: 20990, 75.75: 21064, 76.00: 21139, 76.25: 21213, 76.50: 21287, 76.75: 21361, 77.00: 21435, 77.25: 21509,
    77.50: 21583, 77.75: 21656, 78.00: 21729, 78.25: 21802, 78.50: 21875, 78.75: 21948, 79.00: 22021, 79.25: 22093, 79.50: 22165,
    79.75: 22238, 80.00: 22309, 80.25: 22381, 80.50: 22453, 80.75: 22524, 81.00: 22595, 81.25: 22667, 81.50: 22737, 81.75: 22808,
    82.00: 22879, 82.25: 22949, 82.50: 23019, 82.75: 23089, 83.00: 23159, 83.25: 23228, 83.50: 23298, 83.75: 23367, 84.00: 23436,
    84.25: 23504, 84.50: 23573, 84.75: 23641, 85.00: 23709, 85.25: 23777, 85.50: 23845, 85.75: 23912, 86.00: 23979, 86.25: 24046,
    86.50: 24113, 86.75: 24180, 87.00: 24246, 87.25: 24312, 87.50: 24378, 87.75: 24443, 88.00: 24509, 88.25: 24574, 88.50: 24638,
    88.75: 24703, 89.00: 24767, 89.25: 24831, 89.50: 24895, 89.75: 24959, 90.00: 25022, 90.25: 25085, 90.50: 25148, 90.75: 25210,
    91.00: 25272, 91.25: 25334, 91.50: 25396, 91.75: 25457, 92.00: 25518, 92.25: 25579, 92.50: 25639, 92.75: 25700, 93.00: 25759,
    93.25: 25819, 93.50: 25878, 93.75: 25937, 94.00: 25996, 94.25: 26054, 94.50: 26112, 94.75: 26170, 95.00: 26227, 95.25: 26284,
    95.50: 26341, 95.75: 26397, 96.00: 26454, 96.25: 26509, 96.50: 26565, 96.75: 26620, 97.00: 26675, 97.25: 26729, 97.50: 26783,
    97.75: 26837, 98.00: 26890, 98.25: 26943, 98.50: 26996, 98.75: 27048, 99.00: 27100, 99.25: 27152, 99.50: 27203, 99.75: 27254,
    100.00: 27305, 100.25: 27355, 100.50: 27405, 100.75: 27455, 101.00: 27504, 101.25: 27553, 101.50: 27602, 101.75: 27651, 102.00: 27699,
    102.25: 27747, 102.50: 27795, 102.75: 27842, 103.00: 27889, 103.25: 27936, 103.50: 27983, 103.75: 28029, 104.00: 28075, 104.25: 28121,
    104.50: 28167, 104.75: 28212, 105.00: 28257, 105.25: 28302, 105.50: 28346, 105.75: 28390, 106.00: 28434, 106.25: 28477, 106.50: 28520,
    106.75: 28563, 107.00: 28606, 107.25: 28648, 107.50: 28690, 107.75: 28732, 108.00: 28773, 108.25: 28814, 108.50: 28855, 108.75: 28895,
    109.00: 28935, 109.25: 28975, 109.50: 29015, 109.75: 29055, 110.00: 29094, 110.25: 29133, 110.50: 29171, 110.75: 29210, 111.00: 29248,
    111.25: 29286, 111.50: 29324, 111.75: 29362, 112.00: 29399, 112.25: 29436, 112.50: 29473, 112.75: 29510, 113.00: 29547, 113.25: 29583,
    113.50: 29619, 113.75: 29655, 114.00: 29691, 114.25: 29726, 114.50: 29761, 114.75: 29796, 115.00: 29831, 115.25: 29865, 115.50: 29900,
    115.75: 29934, 116.00: 29968, 116.25: 30001, 116.50: 30035, 116.75: 30068, 117.00: 30101
}

# All data sets dictionary
DATASETS = {
    "SKSX117122": SXSX117122,
    "TCLX290169": TCLX290169
}

def gallons_to_liters(gallons):
    return gallons * 3.78541

def liters_to_gallons(liters):
    return liters / 3.78541

def display_volume(height, tank_data):
    vol_gallons = interpolate(tank_data, height)
    if vol_gallons is None:
        return None
    return vol_gallons

st.title("Railcar Tank Volume Calculator")

# Tank selection
tank_name = st.selectbox("Select Railcar Tank", list(DATASETS.keys()))

# Unit selections with default options
input_unit = st.selectbox("Input height unit", ["cm", "inches"], index=0)
output_unit = st.selectbox("Output volume unit", ["liters", "gallons"], index=0)

tank_data = DATASETS[tank_name]

# Max height in inches for selected tank
max_height_in = max(tank_data.keys())
max_height_cm = inches_to_cm(max_height_in)

if input_unit == "cm":
    height = st.number_input(
        f"Enter height in centimeters (max {max_height_cm:.2f} cm):",
        min_value=0.0,
        max_value=max_height_cm,
        step=0.1,
        format="%.2f"
    )
    height_in = cm_to_inches(height)
else:
    height = st.number_input(
        f"Enter height in inches (max {max_height_in:.2f} in):",
        min_value=0.0,
        max_value=max_height_in,
        step=0.1,
        format="%.2f"
    )
    height_in = height

volume_gallons = interpolate(tank_data, height_in)

if volume_gallons is None:
    st.error("Height is out of range for this tank.")
else:
    if output_unit == "liters":
        volume = gallons_to_liters(volume_gallons)
        st.write(f"Volume: {volume:.2f} liters")
    else:
        st.write(f"Volume: {volume_gallons:.2f} gallons")
