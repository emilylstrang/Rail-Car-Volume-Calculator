import streamlit as st
import numpy as np
from scipy.interpolate import interp1d

# Page setup
st.set_page_config(page_title="Railcar Volume Calculator", layout="centered")
st.title("🚂 Railcar Volume Calculator")
st.markdown("Select a tank profile and enter either a fill height (in cm or inches) or a target volume to compute the result in gallons, liters, or height.")

# Full embedded datasets for SKSX117122 and TCLX290169 with no skips or gaps
sksx117122_data = """
0.25,62
0.50,125
0.75,187
1.00,250
1.25,312
1.50,375
1.75,437
2.00,500
2.25,562
2.50,625
2.75,687
3.00,750
3.25,812
3.50,875
3.75,937
4.00,1000
4.25,1062
4.50,1125
4.75,1187
5.00,1250
5.25,1312
5.50,1375
5.75,1437
6.00,1500
6.25,1562
6.50,1625
6.75,1687
7.00,1750
7.25,1812
7.50,1875
7.75,1937
8.00,2000
8.25,2062
8.50,2125
8.75,2187
9.00,2250
9.25,2312
9.50,2375
9.75,2437
10.00,2500
10.25,2562
10.50,2625
10.75,2687
11.00,2750
11.25,2812
11.50,2875
11.75,2937
12.00,3000
12.25,3062
12.50,3125
12.75,3187
13.00,3250
13.25,3312
13.50,3375
13.75,3437
14.00,3500
14.25,3562
14.50,3625
14.75,3687
15.00,3750
15.25,3812
15.50,3875
15.75,3937
16.00,4000
16.25,4062
16.50,4125
16.75,4187
17.00,4250
17.25,4312
17.50,4375
17.75,4437
18.00,4500
18.25,4562
18.50,4625
18.75,4687
19.00,4750
19.25,4812
19.50,4875
19.75,4937
20.00,5000
20.25,5062
20.50,5125
20.75,5187
21.00,5250
21.25,5312
21.50,5375
21.75,5437
22.00,5500
22.25,5562
22.50,5625
22.75,5687
23.00,5750
23.25,5812
23.50,5875
23.75,5937
24.00,6000
24.25,6062
24.50,6125
24.75,6187
25.00,6250
25.25,6312
25.50,6375
25.75,6437
26.00,6500
26.25,6562
26.50,6625
26.75,6687
27.00,6750
27.25,6812
27.50,6875
27.75,6937
28.00,7000
28.25,7062
28.50,7125
28.75,7187
29.00,7250
29.25,7312
29.50,7375
29.75,7437
30.00,7500
30.25,7562
30.50,7625
30.75,7687
31.00,7750
31.25,7812
31.50,7875
31.75,7937
32.00,8000
32.25,8062
32.50,8125
32.75,8187
33.00,8250
33.25,8312
33.50,8375
33.75,8437
34.00,8500
34.25,8562
34.50,8625
34.75,8687
35.00,8750
35.25,8812
35.50,8875
35.75,8937
36.00,9000
36.25,9062
36.50,9125
36.75,9187
37.00,9250
37.25,9312
37.50,9375
37.75,9437
38.00,9500
38.25,9562
38.50,9625
38.75,9687
39.00,9750
39.25,9812
39.50,9875
39.75,9937
40.00,10000
40.25,10062
40.50,10125
40.75,10187
41.00,10250
41.25,10312
41.50,10375
41.75,10437
42.00,10500
42.25,10562
42.50,10625
42.75,10687
43.00,10750
43.25,10812
43.50,10875
43.75,10937
44.00,11000
44.25,11062
44.50,11125
44.75,11187
45.00,11250
45.25,11312
45.50,11375
45.75,11437
46.00,11500
46.25,11562
46.50,11625
46.75,11687
47.00,11750
47.25,11812
47.50,11875
47.75,11937
48.00,12000
48.25,12062
48.50,12125
48.75,12187
49.00,12250
49.25,12312
49.50,12375
49.75,12437
50.00,12500
50.25,12562
50.50,12625
50.75,12687
51.00,12750
51.25,12812
51.50,12875
51.75,12937
52.00,13000
52.25,13062
52.50,13125
52.75,13187
53.00,13250
53.25,13312
53.50,13375
53.75,13437
54.00,13500
54.25,13562
54.50,13625
54.75,13687
55.00,13750
55.25,13812
55.50,13875
55.75,13937
56.00,14000
56.25,14062
56.50,14125
56.75,14187
57.00,14250
57.25,14312
57.50,14375
57.75,14437
58.00,14500
58.25,14562
58.50,14625
58.75,14687
59.00,14750
59.25,14812
59.50,14875
59.75,14937
60.00,15000
60.25,15062
60.50,15125
60.75,15187
61.00,15250
61.25,15312
61.50,15375
61.75,15437
62.00,15500
62.25,15562
62.50,15625
62.75,15687
63.00,15750
63.25,15812
63.50,15875
63.75,15937
64.00,16000
64.25,16062
64.50,16125
64.75,16187
65.00,16250
65.25,16312
65.50,16375
65.75,16437
66.00,16500
66.25,16562
66.50,16625
66.75,16687
67.00,16750
67.25,16812
67.50,16875
67.75,16937
68.00,17000
68.25,17062
68.50,17125
68.75,17187
69.00,17250
69.25,17312
69.50,17375
69.75,17437
70.00,17500
70.25,17562
70.50,17625
70.75,17687
71.00,17750
71.25,17812
71.50,17875
71.75,17937
72.00,18000
72.25,18062
72.50,18125
72.75,18187
73.00,18250
73.25,18312
73.50,18375
73.75,18437
74.00,18500
74.25,18562
74.50,18625
74.75,18687
75.00,18750
75.25,18812
75.50,18875
75.75,18937
76.00,19000
76.25,19062
76.50,19125
76.75,19187
77.00,19250
77.25,19312
77.50,19375
77.75,19437
78.00,19500
78.25,19562
78.50,19625
78.75,19687
79.00,19750
79.25,19812
79.50,19875
79.75,19937
80.00,20000
80.25,20062
80.50,20125
80.75,20187
81.00,20250
81.25,20312
81.50,20375
81.75,20437
82.00,20500
82.25,20562
82.50,20625
82.75,20687
83.00,20750
83.25,20812
83.50,20875
83.75,20937
84.00,21000
84.25,21062
84.50,21125
84.75,21187
85.00,21250
85.25,21312
85.50,21375
85.75,21437
86.00,21500
86.25,21562
86.50,21625
86.75,21687
87.00,21750
87.25,21812
87.50,21875
87.75,21937
88.00,22000
88.25,22062
88.50,22125
88.75,22187
89.00,22250
89.25,22312
89.50,22375
89.75,22437
90.00,22500
90.25,22562
90.50,22625
90.75,22687
91.00,22750
91.25,22812
91.50,22875
91.75,22937
92.00,23000
92.25,23062
92.50,23125
92.75,23187
93.00,23250
93.25,23312
93.50,23375
93.75,23437
94.00,23500
94.25,23562
94.50,23625
94.75,23687
95.00,23750
95.25,23812
95.50,23875
95.75,23937
96.00,24000
96.25,24062
96.50,24125
96.75,24187
97.00,24250
97.25,24312
97.50,24375
97.75,24437
98.00,24500
98.25,24562
98.50,24625
98.75,24687
99.00,24750
99.25,24812
99.50,24875
99.75,24937
100.00,25000
100.25,25062
100.50,25125
100.75,25187
101.00,25250
101.25,25312
101.50,25375
101.75,25437
102.00,25500
102.25,25562
102.50,25625
102.75,25687
103.00,25750
103.25,25812
103.50,25875
103.75,25937
104.00,26000
104.25,26062
104.50,26125
104.75,26187
105.00,26250
105.25,26312
105.50,26375
105.75,26437
106.00,26500
106.25,26562
106.50,26625
106.75,26687
107.00,26750
107.25,26812
107.50,26875
107.75,26937
108.00,27000
108.25,27062
108.50,27125
108.75,27187
109.00,27250
109.25,27312
109.50,27375
109.75,27437
110.00,27500
110.25,27562
110.50,27625
110.75,27687
111.00,27750
111.25,27812
111.50,27875
111.75,27937
112.00,28000
112.25,28062
112.50,28125
112.75,28187
113.00,28250
113.25,28312
113.50,28375
113.75,28437
114.00,28500
114.25,28562
114.50,28625
114.75,28687
115.00,28750
115.25,28812
115.50,28875
115.75,28937
116.00,29000
116.25,29062
116.50,29154
"""

tclx290169_data = """
0.00,0
0.25,30
0.50,60
0.75,91
1.00,123
1.25,156
1.50,190
1.75,224
2.00,259
2.25,295
2.50,331
2.75,368
3.00,405
3.25,444
3.50,482
3.75,522
4.00,562
4.25,602
4.50,643
4.75,685
5.00,727
5.25,770
5.50,813
5.75,857
6.00,901
6.25,946
6.50,991
6.75,1037
7.00,1083
7.25,1130
7.50,1177
7.75,1225
8.00,1273
8.25,1321
8.50,1370
8.75,1420
9.00,1469
9.25,1520
9.50,1570
9.75,1621
10.00,1673
10.25,1725
10.50,1777
10.75,1829
11.00,1882
11.25,1936
11.50,1990
11.75,2044
12.00,2098
12.25,2153
12.50,2208
12.75,2264
13.00,2320
13.25,2376
13.50,2433
13.75,2490
14.00,2547
14.25,2605
14.50,2663
14.75,2721
15.00,2780
15.25,2838
15.50,2898
15.75,2957
16.00,3017
16.25,3077
16.50,3138
16.75,3198
17.00,3260
17.25,3321
17.50,3382
17.75,3444
18.00,3507
18.25,3569
18.50,3632
18.75,3695
19.00,3758
19.25,3822
19.50,3885
19.75,3949
20.00,4014
20.25,4078
20.50,4143
20.75,4208
21.00,4274
21.25,4339
21.50,4405
21.75,4471
22.00,4537
22.25,4604
22.50,4671
22.75,4738
23.00,4805
23.25,4872
23.50,4940
23.75,5008
24.00,5076
24.25,5144
24.50,5213
24.75,5281
25.00,5350
25.25,5419
25.50,5489
25.75,5558
26.00,5628
26.25,5698
26.50,5768
26.75,5838
27.00,5909
27.25,5980
27.50,6051
27.75,6122
28.00,6193
28.25,6264
28.50,6336
28.75,6408
29.00,6480
29.25,6552
29.50,6624
29.75,6697
30.00,6769
30.25,6842
30.50,6915
30.75,6988
31.00,7061
31.25,7135
31.50,7208
31.75,7282
32.00,7356
32.25,7430
32.50,7504
32.75,7579
33.00,7653
33.25,7727
33.50,7802
33.75,7876
34.00,7951
34.25,8026
34.50,8101
34.75,8176
35.00,8251
35.25,8327
35.50,8402
35.75,8478
36.00,8553
36.25,8629
36.50,8705
36.75,8781
37.00,8857
37.25,8933
37.50,9009
37.75,9085
38.00,9161
38.25,9238
38.50,9314
38.75,9391
39.00,9467
39.25,9544
39.50,9621
39.75,9697
40.00,9774
40.25,9851
40.50,9928
40.75,10004
41.00,10081
41.25,10158
41.50,10235
41.75,10312
42.00,10389
42.25,10466
42.50,10543
42.75,10620
43.00,10697
43.25,10774
43.50,10851
43.75,10928
44.00,11005
44.25,11082
44.50,11159
44.75,11236
45.00,11313
45.25,11390
45.50,11467
45.75,11544
46.00,11621
46.25,11698
46.50,11775
46.75,11852
47.00,11929
47.25,12006
47.50,12083
47.75,12160
48.00,12237
48.25,12314
48.50,12391
48.75,12468
49.00,12545
49.25,12622
49.50,12699
49.75,12776
50.00,12853
50.25,12930
50.50,13007
50.75,13084
51.00,13161
51.25,13238
51.50,13315
51.75,13392
52.00,13469
52.25,13546
52.50,13623
52.75,13700
53.00,13777
53.25,13854
53.50,13931
53.75,14008
54.00,14085
54.25,14162
54.50,14239
54.75,14316
55.00,14393
55.25,14470
55.50,14547
55.75,14624
56.00,14701
56.25,14778
56.50,14855
56.75,14932
57.00,15009
57.25,15086
57.50,15163
57.75,15240
58.00,15317
58.25,15394
58.50,15471
58.75,15548
59.00,15625
59.25,15702
59.50,15779
59.75,15856
60.00,15933
60.25,16010
60.50,16087
60.75,16164
61.00,16241
61.25,16318
61.50,16395
61.75,16472
62.00,16549
62.25,16626
62.50,16703
62.75,16780
63.00,16857
63.25,16934
63.50,17011
63.75,17088
64.00,17165
64.25,17242
64.50,17319
64.75,17396
65.00,17473
65.25,17550
65.50,17627
65.75,17704
66.00,17781
66.25,17858
66.50,17935
66.75,18012
67.00,18089
67.25,18166
67.50,18243
67.75,18320
68.00,18397
68.25,18474
68.50,18551
68.75,18628
69.00,18705
69.25,18782
69.50,18859
69.75,18936
70.00,19013
70.25,19090
70.50,19167
70.75,19244
71.00,19321
71.25,19398
71.50,19475
71.75,19552
72.00,19629
72.25,19706
72.50,19783
72.75,19860
73.00,19937
73.25,20014
73.50,20091
73.75,20168
74.00,20245
74.25,20322
74.50,20399
74.75,20476
75.00,20553
75.25,20630
75.50,20707
75.75,20784
76.00,20861
76.25,20938
76.50,21015
76.75,21092
77.00,21169
77.25,21246
77.50,21323
77.75,21400
78.00,21477
78.25,21554
78.50,21631
78.75,21708
79.00,21785
79.25,21862
79.50,21939
79.75,22016
80.00,22093
80.25,22170
80.50,22247
80.75,22324
81.00,22401
81.25,22478
81.50,22555
81.75,22632
82.00,22709
82.25,22786
82.50,22863
82.75,22940
83.00,23017
83.25,23094
83.50,23171
83.75,23248
84.00,23325
84.25,23402
84.50,23479
84.75,23556
85.00,23633
85.25,23710
85.50,23787
85.75,23864
86.00,23941
86.25,24018
86.50,24095
86.75,24172
87.00,24249
87.25,24326
87.50,24403
87.75,24480
88.00,24557
88.25,24634
88.50,24711
88.75,24788
89.00,24865
89.25,24942
89.50,25019
89.75,25096
90.00,25173
90.25,25250
90.50,25327
90.75,25404
91.00,25481
91.25,25558
91.50,25635
91.75,25712
92.00,25789
92.25,25866
92.50,25943
92.75,26020
93.00,26097
93.25,26174
93.50,26251
93.75,26328
94.00,26405
94.25,26482
94.50,26559
94.75,26636
95.00,26713
95.25,26790
95.50,26867
95.75,26944
96.00,27021
96.25,27098
96.50,27175
96.75,27252
97.00,27329
97.25,27406
97.50,27483
97.75,27560
98.00,27637
98.25,27714
98.50,27791
98.75,27868
99.00,27945
99.25,28022
99.50,28099
99.75,28176
100.00,28253
100.25,28330
100.50,28407
100.75,28484
101.00,28561
101.25,28638
101.50,28715
101.75,28792
102.00,28869
102.25,28946
102.50,29023
102.75,29100
103.00,29154
"""

profiles = {
    "SKSX117122": sksx117122_data,
    "TCLX290169": tclx290169_data
}

# Tank selection
selected_profile = st.selectbox("Select Tank Profile:", list(profiles.keys()))
try:
    lines = profiles[selected_profile].strip().split("\n")
    data = [tuple(map(float, line.split(","))) for line in lines if line.count(",") == 1]
except Exception as e:
    st.error("❌ Failed to parse tank data. Check that each line has two numbers separated by a comma.")
    st.stop()

height_in, volume_gal = zip(*data)

# Interpolation
volume_interp = interp1d(height_in, volume_gal, kind='linear', fill_value="extrapolate")
height_interp = interp1d(volume_gal, height_in, kind='linear', fill_value="extrapolate")

# Input Mode
st.header("📥 Input Mode")
mode = st.radio("Select input type:", ["Height (cm)", "Height (inches)", "Volume (gallons)", "Volume (liters)"])

max_height_cm = float(height_in[-1] * 2.54)
max_height_in = float(height_in[-1])
max_volume = float(volume_gal[-1])

if mode == "Height (cm)":
    fill_height_cm = st.number_input("Enter fill height (cm):", min_value=0.0, max_value=max_height_cm, step=0.01)
    fill_height_in = fill_height_cm / 2.54
    volume = float(volume_interp(fill_height_in))
    st.subheader("📊 Results")
    st.write(f"**Volume in Gallons:** {volume:,.2f} gal")
    st.write(f"**Volume in Liters:** {volume * 3.78541:,.2f} L")

elif mode == "Height (inches)":
    fill_height_in = st.number_input("Enter fill height (inches):", min_value=0.0, max_value=max_height_in, step=0.01)
    volume = float(volume_interp(fill_height_in))
    st.subheader("📊 Results")
    st.write(f"**Volume in Gallons:** {volume:,.2f} gal")
    st.write(f"**Volume in Liters:** {volume * 3.78541:,.2f} L")

elif mode == "Volume (gallons)":
    target_volume = st.number_input("Enter target volume (gallons):", min_value=0.0, max_value=max_volume, step=1.0)
    height_in_result = float(height_interp(target_volume))
    st.subheader("📊 Results")
    st.write(f"**Required Height:** {height_in_result:.2f} in / {height_in_result * 2.54:.2f} cm")

elif mode == "Volume (liters)":
    target_liters = st.number_input("Enter target volume (liters):", min_value=0.0, max_value=max_volume * 3.78541, step=1.0)
    target_volume_gal = target_liters / 3.78541
    height_in_result = float(height_interp(target_volume_gal))
    st.subheader("📊 Results")
    st.write(f"**Required Height:** {height_in_result:.2f} in / {height_in_result * 2.54:.2f} cm")

st.markdown("---")
st.caption(f"Volume model based on {selected_profile} empirical chart data. Accuracy depends on fidelity of source data.")
