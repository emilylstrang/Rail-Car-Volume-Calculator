import streamlit as st

# Conversion functions
def inches_to_cm(inches):
    return inches * 2.54

def cm_to_inches(cm):
    return cm / 2.54

# Interpolation function
def interpolate(data, height):
    heights = sorted(data.keys())
    if height < heights[0] or height > heights[-1]:
        return None
    if height in data:
        return data[height]
    # Find interval for interpolation
    for i in range(len(heights)-1):
        h0, h1 = heights[i], heights[i+1]
        if h0 < height < h1:
            v0, v1 = data[h0], data[h1]
            # Linear interpolation
            return v0 + (v1 - v0) * (height - h0) / (h1 - h0)
    return None  # just in case

# Full dataset for SKSX117122 (height in inches : gallons)
SXSX117122 = {
    0.25: 23, 0.5: 47, 0.75: 72, 1.0: 98, 1.25: 125, 1.5: 153, 1.75: 182, 2.0: 212,
    2.25: 242, 2.5: 274, 2.75: 306, 3.0: 339, 3.25: 373, 3.5: 408, 3.75: 443, 4.0: 479,
    4.25: 516, 4.5: 553, 4.75: 591, 5.0: 629, 5.25: 669, 5.5: 709, 5.75: 749, 6.0: 790,
    6.25: 832, 6.5: 874, 6.75: 916, 7.0: 960, 7.25: 1004, 7.5: 1048, 7.75: 1093, 8.0: 1138,
    8.25: 1184, 8.5: 1230, 8.75: 1277, 9.0: 1325, 9.25: 1373, 9.5: 1421, 9.75: 1470,
    10.0: 1519, 10.25: 1568, 10.5: 1619, 10.75: 1669, 11.0: 1720, 11.25: 1772, 11.5: 1823,
    11.75: 1876, 12.0: 1928, 12.25: 1981, 12.5: 2035, 12.75: 2089, 13.0: 2143, 13.25: 2198,
    13.5: 2253, 13.75: 2308, 14.0: 2364, 14.25: 2420, 14.5: 2476, 14.75: 2533, 15.0: 2591,
    15.25: 2648, 15.5: 2706, 15.75: 2764, 16.0: 2823, 16.25: 2882, 16.5: 2941, 16.75: 3001,
    17.0: 3061, 17.25: 3121, 17.5: 3181, 17.75: 3242, 18.0: 3303, 18.25: 3365, 18.5: 3427,
    18.75: 3489, 19.0: 3551, 19.25: 3614, 19.5: 3677, 19.75: 3740, 20.0: 3804, 20.25: 3867,
    20.5: 3931, 20.75: 3996, 21.0: 4060, 21.25: 4125, 21.5: 4191, 21.75: 4256, 22.0: 4322,
    22.25: 4388, 22.5: 4454, 22.75: 4520, 23.0: 4587, 23.25: 4654, 23.5: 4721, 23.75: 4789,
    24.0: 4856, 24.25: 4924, 24.5: 4992, 24.75: 5061, 25.0: 5129, 25.25: 5198, 25.5: 5267,
    25.75: 5337, 26.0: 5406, 26.25: 5476, 26.5: 5546, 26.75: 5616, 27.0: 5686, 27.25: 5757,
    27.5: 5828, 27.75: 5899, 28.0: 5970, 28.25: 6041, 28.5: 6113, 28.75: 6185, 29.0: 6256,
    29.25: 6329, 29.5: 6401, 29.75: 6473, 30.0: 6546, 30.25: 6619, 30.5: 6692, 30.75: 6765,
    31.0: 6839, 31.25: 6912, 31.5: 6986, 31.75: 7060, 32.0: 7134, 32.25: 7208, 32.5: 7283,
    32.75: 7357, 33.0: 7432, 33.25: 7507, 33.5: 7582, 33.75: 7657, 34.0: 7732, 34.25: 7808,
    34.5: 7883, 34.75: 7959, 35.0: 8035, 35.25: 8111, 35.5: 8187, 35.75: 8264, 36.0: 8340,
    36.25: 8417, 36.5: 8493, 36.75: 8570, 37.0: 8647, 37.25: 8724, 37.5: 8802, 37.75: 8879,
    38.0: 8956, 38.25: 9034, 38.5: 9112, 38.75: 9189, 39.0: 9267, 39.25: 9345, 39.5: 9423,
    39.75: 9502, 40.0: 9580, 40.25: 9658, 40.5: 9737, 40.75: 9816, 41.0: 9894, 41.25: 9973,
    41.5: 10052, 41.75: 10131, 42.0: 10210, 42.25: 10290, 42.5: 10369, 42.75: 10448,
    43.0: 10528, 43.25: 10607, 43.5: 10687, 43.75: 10767, 44.0: 10847, 44.25: 10926,
    44.5: 11006, 44.75: 11086, 45.0: 11166, 45.25: 11247, 45.5: 11327, 45.75: 11407,
    46.0: 11487, 46.25: 11568, 46.5: 11648, 46.75: 11729, 47.0: 11809, 47.25: 11890,
    47.5: 11971, 47.75: 12051, 48.0: 12132, 48.25: 12213, 48.5: 12294, 48.75: 12375,
    49.0: 12456, 49.25: 12537, 49.5: 12618, 49.75: 12699, 50.0: 12780, 50.25: 12861,
    50.5: 12943, 50.75: 13024, 51.0: 13105, 51.25: 13186, 51.5: 13268, 51.75: 13349,
    52.0: 13430, 52.25: 13512, 52.5: 13593, 52.75: 13675, 53.0: 13756, 53.25: 13837,
    53.5: 13919, 53.75: 14000, 54.0: 14082, 54.25: 14163, 54.5: 14245, 54.75: 14326,
    55.0: 14408, 55.25: 14490, 55.5: 14571, 55.75: 14653, 56.0: 14734, 56.25: 14816,
    56.5: 14897, 56.75: 14979, 57.0: 15060, 57.25: 15142, 57.5: 15223, 57.75: 15305,
    58.0: 15386, 58.25: 15468, 58.5: 15549, 58.75: 15631, 59.0: 15712, 59.25: 15794,
    59.5: 15875, 59.75: 15956, 60.0: 16037, 60.25: 16119, 60.5: 16200, 60.75: 16281,
    61.0: 16362, 61.25: 16443, 61.5: 16524, 61.75: 16605, 62.0: 16686, 62.25: 16767,
    62.5: 16848, 62.75: 16929, 63.0: 17010, 63.25: 17091, 63.5: 17172, 63.75: 17252,
    64.0: 17333, 64.25: 17414, 64.5: 17495, 64.75: 17575, 65.0: 17656, 65.25: 17737,
    65.5: 17817, 65.75: 17898, 66.0: 17978, 66.25: 18059, 66.5: 18139, 66.75: 18219,
    67.0: 18299, 67.25: 18379, 67.5: 18460, 67.75: 18540, 68.0: 18620, 68.25: 18700,
    68.5: 18780, 68.75: 18860, 69.0: 18940, 69.25: 19020, 69.5: 19100, 69.75: 19180,
    70.0: 19260, 70.25: 19340, 70.5: 19420, 70.75: 19500, 71.0: 19580, 71.25: 19660,
    71.5: 19740, 71.75: 19820, 72.0: 19900, 72.25: 19980, 72.5: 20060, 72.75: 20140,
    73.0: 20220, 73.25: 20300, 73.5: 20380, 73.75: 20460, 74.0: 20540, 74.25: 20620,
    74.5: 20700, 74.75: 20780, 75.0: 20860, 75.25: 20940, 75.5: 21020, 75.75: 21100,
    76.0: 21180, 76.25: 21260, 76.5: 21340, 76.75: 21420, 77.0: 21500, 77.25: 21580,
    77.5: 21660, 77.75: 21740, 78.0: 21820, 78.25: 21900, 78.5: 21980, 78.75: 22060,
    79.0: 22140, 79.25: 22220, 79.5: 22300, 79.75: 22380, 80.0: 22460, 80.25: 22540,
    80.5: 22620, 80.75: 22700, 81.0: 22780, 81.25: 22860, 81.5: 22940, 81.75: 23020,
    82.0: 23100, 82.25: 23180, 82.5: 23260, 82.75: 23340, 83.0: 23420, 83.25: 23500,
    83.5: 23580, 83.75: 23660, 84.0: 23740, 84.25: 23820, 84.5: 23900, 84.75: 23980,
    85.0: 24060, 85.25: 24140, 85.5: 24220, 85.75: 24300, 86.0: 24380, 86.25: 24460,
    86.5: 24540, 86.75: 24620, 87.0: 24700, 87.25: 24780, 87.5: 24860, 87.75: 24940,
    88.0: 25020, 88.25: 25100, 88.5: 25180, 88.75: 25260, 89.0: 25340, 89.25: 25420,
    89.5: 25500, 89.75: 25580, 90.0: 25660, 90.25: 25740, 90.5: 25820, 90.75: 25900,
    91.0: 25980, 91.25: 26060, 91.5: 26140, 91.75: 26220, 92.0: 26300, 92.25: 26380,
    92.5: 26460, 92.75: 26540, 93.0: 26620, 93.25: 26700, 93.5: 26780, 93.75: 26860,
    94.0: 26940, 94.25: 27020, 94.5: 27100, 94.75: 27180, 95.0: 27260, 95.25: 27340,
    95.5: 27420, 95.75: 27500, 96.0: 27580, 96.25: 27660, 96.5: 27740, 96.75: 27820,
    97.0: 27900, 97.25: 27980, 97.5: 28060, 97.75: 28140, 98.0: 28220, 98.25: 28300,
    98.5: 28380, 98.75: 28460, 99.0: 28540, 99.25: 28620, 99.5: 28700, 99.75: 28780,
    100.0: 28860, 100.25: 28940, 100.5: 29020, 100.75: 29100, 101.0: 29180, 101.25: 29260,
    101.5: 29340, 101.75: 29420, 102.0: 29500, 102.25: 29580, 102.5: 29660, 102.75: 29740,
    103.0: 29820, 103.25: 29900, 103.5: 29980, 103.75: 30060, 104.0: 30140, 104.25: 30220,
    104.5: 30300, 104.75: 30380, 105.0: 30460, 105.25: 30540, 105.5: 30620, 105.75: 30700,
    106.0: 30780, 106.25: 30860, 106.5: 30940, 106.75: 31020, 107.0: 31100, 107.25: 31180,
    107.5: 31260, 107.75: 31340, 108.0: 31420, 108.25: 31500, 108.5: 31580, 108.75: 31660,
    109.0: 31740, 109.25: 31820, 109.5: 31900, 109.75: 31980, 110.0: 32060, 110.25: 32140,
    110.5: 32220, 110.75: 32300, 111.0: 32380, 111.25: 32460, 111.5: 32540, 111.75: 32620,
    112.0: 32700, 112.25: 32780, 112.5: 32860, 112.75: 32940, 113.0: 33020, 113.25: 33100,
    113.5: 33180, 113.75: 33260, 114.0: 33340, 114.25: 33420, 114.5: 33500, 114.75: 33580,
    115.0: 33660, 115.25: 33740, 115.5: 33820, 115.75: 33900, 116.0: 33980, 116.25: 34060,
    116.5: 34140, 116.75: 34220, 117.0: 34300
}

# Full dataset for TCLX290169 (height in inches : gallons)
TCLX290169 = {
    0.00: 0, 0.25: 30, 0.50: 60, 0.75: 91, 1.00: 123, 1.25: 156, 1.50: 190, 1.75: 224,
    2.00: 259, 2.25: 295, 2.50: 331, 2.75: 368, 3.00: 405, 3.25: 444, 3.50: 482, 3.75: 522,
    4.00: 562, 4.25: 602, 4.50: 643, 4.75: 685, 5.00: 727, 5.25: 770, 5.50: 813, 5.75: 857,
    6.00: 901, 6.25: 946, 6.50: 991, 6.75: 1037, 7.00: 1083, 7.25: 1130, 7.50: 1177, 7.75: 1225,
    8.00: 1273, 8.25: 1321, 8.50: 1370, 8.75: 1420, 9.00: 1469, 9.25: 1520, 9.50: 1570, 9.75: 1621,
    10.00: 1673, 10.25: 1725, 10.50: 1777, 10.75: 1829, 11.00: 1882, 11.25: 1936, 11.50: 1990, 11.75: 2044,
    12.00: 2098, 12.25: 2153, 12.50: 2208, 12.75: 2264, 13.00: 2320, 13.25: 2376, 13.50: 2433, 13.75: 2490,
    14.00: 2547, 14.25: 2605, 14.50: 2663, 14.75: 2721, 15.00: 2780, 15.25: 2838, 15.50: 2898, 15.75: 2957,
    16.00: 3017, 16.25: 3077, 16.50: 3138, 16.75: 3198, 17.00: 3260, 17.25: 3321, 17.50: 3382, 17.75: 3444,
    18.00: 3507, 18.25: 3569, 18.50: 3632, 18.75: 3695, 19.00: 3758, 19.25: 3822, 19.50: 3885, 19.75: 3949,
    20.00: 4014, 20.25: 4078, 20.50: 4143, 20.75: 4208, 21.00: 4274, 21.25: 4339, 21.50: 4405, 21.75: 4471,
    22.00: 4537, 22.25: 4604, 22.50: 4671, 22.75: 4738, 23.00: 4805, 23.25: 4872, 23.50: 4940, 23.75: 5008,
    24.00: 5076, 24.25: 5144, 24.50: 5213, 24.75: 5281, 25.00: 5350, 25.25: 5419, 25.50: 5489, 25.75: 5558,
    26.00: 5628, 26.25: 5698, 26.50: 5768, 26.75: 5838, 27.00: 5909, 27.25: 5980, 27.50: 6051, 27.75: 6122,
    28.00: 6193, 28.25: 6264, 28.50: 6336, 28.75: 6408, 29.00: 6480, 29.25: 6552, 29.50: 6624, 29.75: 6697,
    30.00: 6769, 30.25: 6842, 30.50: 6915, 30.75: 6988, 31.00: 7061, 31.25: 7135, 31.50: 7208, 31.75: 7282,
    32.00: 7356, 32.25: 7430, 32.50: 7504, 32.75: 7579, 33.00: 7653, 33.25: 7728, 33.50: 7802, 33.75: 7877,
    34.00: 7952, 34.25: 8028, 34.50: 8103, 34.75: 8178, 35.00: 8254, 35.25: 8329, 35.50: 8405, 35.75: 8481,
    36.00: 8557, 36.25: 8633, 36.50: 8710, 36.75: 8786, 37.00: 8862, 37.25: 8939, 37.50: 9016, 37.75: 9093,
    38.00: 9170, 38.25: 9247, 38.50: 9324, 38.75: 9401, 39.00: 9478, 39.25: 9556, 39.50: 9633, 39.75: 9711,
    40.00: 9789, 40.25: 9866, 40.50: 9944, 40.75: 10022, 41.00: 10100, 41.25: 10178, 41.50: 10257, 41.75: 10335,
    42.00: 10413, 42.25: 10492, 42.50: 10570, 42.75: 10649, 43.00: 10728, 43.25: 10807, 43.50: 10885,
    43.75: 10964, 44.00: 11043, 44.25: 11122, 44.50: 11201, 44.75: 11281, 45.00: 11360, 45.25: 11439,
    45.50: 11518, 45.75: 11598, 46.00: 11677, 46.25: 11757, 46.50: 11836, 46.75: 11916, 47.00: 11996,
    47.25: 12075, 47.50: 12155, 47.75: 12235, 48.00: 12315, 48.25: 12395, 48.50: 12474, 48.75: 12554,
    49.00: 12634, 49.25: 12714, 49.50: 12794, 49.75: 12874, 50.00: 12955, 50.25: 13035, 50.50: 13115,
    50.75: 13195, 51.00: 13275, 51.25: 13355, 51.50: 13436, 51.75: 13516, 52.00: 13596, 52.25: 13676,
    52.50: 13757, 52.75: 13837, 53.00: 13917, 53.25: 13998, 53.50: 14078, 53.75: 14158, 54.00: 14239,
    54.25: 14319, 54.50: 14399, 54.75: 14480, 55.00: 14560, 55.25: 14640, 55.50: 14721, 55.75: 14801,
    56.00: 14881, 56.25: 14962, 56.50: 15042, 56.75: 15122, 57.00: 15202, 57.25: 15283, 57.50: 15363,
    57.75: 15443, 58.00: 15523, 58.25: 15604, 58.50: 15684, 58.75: 15764, 59.00: 15844, 59.25: 15924,
    59.50: 16004, 59.75: 16084, 60.00: 16164, 60.25: 16244, 60.50: 16324, 60.75: 16404, 61.00: 16483,
    61.25: 16563, 61.50: 16643, 61.75: 16723, 62.00: 16802, 62.25: 16882, 62.50: 16961, 62.75: 17041,
    63.00: 17120, 63.25: 17200, 63.50: 17279, 63.75: 17358, 64.00: 17438, 64.25: 17517, 64.50: 17596,
    64.75: 17675, 65.00: 17754, 65.25: 17833, 65.50: 17912, 65.75: 17990, 66.00: 18069, 66.25: 18148,
    66.50: 18226, 66.75: 18305, 67.00: 18383, 67.25: 18461, 67.50: 18540, 67.75: 18618, 68.00: 18696,
    68.25: 18774, 68.50: 18852, 68.75: 18929, 69.00: 19007, 69.25: 19085, 69.50: 19162, 69.75: 19240,
    70.00: 19317, 70.25: 19394, 70.50: 19471, 70.75: 19548, 71.00: 19625, 71.25: 19702, 71.50: 19779,
    71.75: 19855, 72.00: 19932, 72.25: 20008, 72.50: 20084, 72.75: 20161, 73.00: 20237, 73.25: 20313,
    73.50: 20388, 73.75: 20464, 74.00: 20539, 74.25: 20615, 74.50: 20690, 74.75: 20765, 75.00: 20840,
    75.25: 20915, 75.50: 20990, 75.75: 21064, 76.00: 21139, 76.25: 21213, 76.50: 21287, 76.75: 21361,
    77.00: 21435, 77.25: 21509, 77.50: 21583, 77.75: 21656, 78.00: 21729, 78.25: 21802, 78.50: 21875,
    78.75: 21948, 79.00: 22021, 79.25: 22093, 79.50: 22165, 79.75: 22238, 80.00: 22309, 80.25: 22381,
    80.50: 22453, 80.75: 22524, 81.00: 22595, 81.25: 22667, 81.50: 22737, 81.75: 22808, 82.00: 22879,
    82.25: 22949, 82.50: 23019, 82.75: 23089, 83.00: 23159, 83.25: 23228, 83.50: 23298, 83.75: 23367,
    84.00: 23436, 84.25: 23504, 84.50: 23573, 84.75: 23641, 85.00: 23709, 85.25: 23777, 85.50: 23845,
    85.75: 23912, 86.00: 23979, 86.25: 24046, 86.50: 24113, 86.75: 24180, 87.00: 24246, 87.25: 24312,
    87.50: 24378, 87.75: 24443, 88.00: 24509, 88.25: 24574, 88.50: 24638, 88.75: 24703, 89.00: 24767,
    89.25: 24831, 89.50: 24895, 89.75: 24959, 90.00: 25022, 90.25: 25085, 90.50: 25148, 90.75: 25210,
    91.00: 25272, 91.25: 25334, 91.50: 25396, 91.75: 25457, 92.00: 25518, 92.25: 25579, 92.50: 25639,
    92.75: 25700, 93.00: 25759, 93.25: 25819, 93.50: 25878, 93.75: 25937, 94.00: 25996, 94.25: 26054,
    94.50: 26112, 94.75: 26170, 95.00: 26228, 95.25: 26285, 95.50: 26342, 95.75: 26399, 96.00: 26456,
    96.25: 26512, 96.50: 26568, 96.75: 26624, 97.00: 26679, 97.25: 26735, 97.50: 26789, 97.75: 26844,
    98.00: 26898, 98.25: 26952, 98.50: 27005, 98.75: 27059, 99.00: 27112, 99.25: 27165, 99.50: 27218,
    99.75: 27271, 100.00: 27323, 100.25: 27375, 100.50: 27427, 100.75: 27479, 101.00: 27530,
    101.25: 27582, 101.50: 27633, 101.75: 27684, 102.00: 27734, 102.25: 27785, 102.50: 27835,
    102.75: 27885, 103.00: 27935, 103.25: 27984, 103.50: 28034, 103.75: 28083, 104.00: 28132,
    104.25: 28181, 104.50: 28230, 104.75: 28279, 105.00: 28328, 105.25: 28376, 105.50: 28424,
    105.75: 28472, 106.00: 28520, 106.25: 28568, 106.50: 28616, 106.75: 28663, 107.00: 28711,
    107.25: 28758, 107.50: 28805, 107.75: 28852, 108.00: 28899, 108.25: 28945, 108.50: 28992,
    108.75: 29038, 109.00: 29084, 109.25: 29130, 109.50: 29175, 109.75: 29221, 110.00: 29266,
    110.25: 29311, 110.50: 29356, 110.75: 29401, 111.00: 29446, 111.25: 29490, 111.50: 29534,
    111.75: 29578, 112.00: 29622, 112.25: 29666, 112.50: 29710, 112.75: 29753, 113.00: 29797,
    113.25: 29840, 113.50: 29883, 113.75: 29926, 114.00: 29969, 114.25: 30011, 114.50: 30054,
    114.75: 30096, 115.00: 30139, 115.25: 30181, 115.50: 30223, 115.75: 30264, 116.00: 30306,
    116.25: 30348, 116.50: 30389, 116.75: 30431, 117.00: 30472
}

# Mapping for easier access
tank_data = {
    "SKSX117122": SXSX117122,
    "TCLX290169": TCLX290169
}

# Main app
def main():
    st.title("Railcar Tank Volume Calculator")

    # Tank selection
    tank_choice = st.selectbox("Select Railcar Tank", options=list(tank_data.keys()))

    # Unit selection
    height_unit = st.radio("Input height unit", options=["inches", "cm"])
    volume_unit = st.radio("Output volume unit", options=["gallons", "litres"])

    # Get data for selected tank
    data = tank_data[tank_choice]

    # Set max height limits in inches
    max_height_in_inches = max(data.keys())

    # Prompt user for height input
    if height_unit == "inches":
        height = st.number_input(f"Enter height ({height_unit})", min_value=0.0, max_value=max_height_in_inches, step=0.25)
        height_in_inches = height
    else:
        max_height_cm = inches_to_cm(max_height_in_inches)
        height = st.number_input(f"Enter height ({height_unit})", min_value=0.0, max_value=max_height_cm, step=0.25)
        height_in_inches = cm_to_inches(height)

    # Calculate volume in gallons (exact or interpolated)
    volume_gallons = interpolate(data, round(height_in_inches * 4) / 4)  # rounding input to nearest 0.25 inches for interpolation accuracy

    if volume_gallons is None:
        st.error("Height out of range for selected tank.")
        return

    # Convert volume if needed
    if volume_unit == "litres":
        volume = volume_gallons * 3.78541
        st.write(f"Volume at {height} {height_unit} is: {volume:.2f} litres")
    else:
        st.write(f"Volume at {height} {height_unit} is: {volume_gallons:.2f} gallons")

if __name__ == "__main__":
    main()
